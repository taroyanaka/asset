<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚²ãƒ¼ãƒ ãƒ–ãƒƒã‚¯ä½œæˆã‚¢ãƒ—ãƒª</title>
  <!-- https://taroyanaka.github.io/asset/rpg/gamebook_maker_with_dice.html?play=true -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .node-list { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .node-button {
      padding: 10px;
      /* background: #ccc; */
      /* border: 1px solid #999; */
      border: 1px solid;
      border-radius: 5px;
      cursor: pointer;
    }
    .node-button.active { background: #88f; color: white; }
    .editor, .play-view, .graph-view {
      border: 1px solid #aaa;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    textarea { width: 100%; height: 4em; }
    input { width: 100%; margin-bottom: 5px; }
    /* ãƒœã‚¿ãƒ³ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¦ç´ ã«å¤‰æ›´ */
    .btn {
      display: inline;
      padding: 10px 15px;
      background: #fff;
      /* border: 1px solid #fff; */
      /* ç‚¹ç·šã«ã™ã‚‹ */
      border: 1px dashed #999;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
      margin-right: 10px;
      text-decoration: none;
      color: black;
      /* fontã‚µã‚¤ã‚ºã‚’3remã«ã™ã‚‹ */
      font-size: 3rem;
    }
    .playingNode-text {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .end { background: #ffe0e0; padding: 10px; margin-top: 10px; border-radius: 5px; }
    .danger { color: red; font-weight: bold; cursor: pointer; margin-left: 5px; }
    .graph-view { background: #f9f9f9; }
    .graph-view ul { padding-left: 1.5em; }
    /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã‚’100ã«ã—ã¦ */
    .play-view { max-width: 100vw; margin: 0 auto; padding: 0.5rem; border-radius: 8px; }
    .play-view img { max-width: 90vw; max-height: 300px; border: 1px solid #ccc; border-radius: 4px; }
    .btn:hover { background: #f9f9f9; }
    .btn:active { background: #f9f9f9; }
    .danger:hover { text-decoration: underline; }
    .danger:active { color: darkred; }
    .node-button span { color: red; font-weight: bold; cursor: pointer; }
    .node-button span:hover { text-decoration: underline; }
    .node-button span:active { color: darkred; }
    /* ãƒœã‚¿ãƒ³ã‚’100%ã«ã—ã¦ */
    .btn { width: 100%; }
    .btn + .btn { margin-left: 10px; }
    .editor input, .editor textarea { width: calc(100% - 20px); }
    .editor div { margin-bottom: 10px; }
    .editor label { display: block; margin-bottom: 5px; }
    .editor img { max-width: 100%; height: auto; border: 1px solid #ccc; border-radius: 4px; margin-top: 5px; }
    .node-list .node-button { flex: 1 1 calc(20% - 20px); box-sizing: border-box; }
    .play-node {
      width: 85vw;
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
/* .reset-btn ã‚’ç”»é¢å·¦ä¸Šã®â‰¡ãƒœã‚¿ãƒ³ã«é…ç½®ã—ã¦ */
    .reset-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 10px 15px;
      background: #fff;
      border: 1px dashed #999;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      color: black;
      font-size: 1.8rem;
    }
    /* .reset-btn:hover { background: #ddd; } */
    /* .reset-btn:active { background: #bbb; } */
    .go-to-btn {
      margin-bottom: 0.6rem;
    }





  </style>
</head>
<body>
  <div id="app">
    <template v-if="playMode">
      <div class="play-view">
        <!-- <h2>ãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰</h2> -->
         <!-- ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨2ã‹ã‚‰12ã®æ•°å€¤ã‚’è¡¨ç¤º -->
<button @click="diceResult = Math.floor(Math.random() * 11) + 2" class="btn">ğŸ²<span v-if="diceResult !== null" style="margin:8px 0;">:{{ diceResult }}</span></button>



        <div v-if="playingNode">
          <div v-if="playingNode.imageUrl" style="margin: 10px 0;">
            <img :src="playingNode.imageUrl" alt="ãƒãƒ¼ãƒ‰ç”»åƒ" class="play-node" />
          </div>
          <p class="playingNode-text">{{ playingNode.text }}</p>
          <div v-if="!playingNode.choices[0].next && !playingNode.choices[1].next" class="end">ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</div>
          <div v-if="hasDiceBranch(playingNode)">
            <button @click="rollDiceForNode" class="btn">ãƒ€ã‚¤ã‚¹ã§åˆ†å²</button>
            <div v-if="diceResult !== null" style="margin:8px 0;">ãƒ€ã‚¤ã‚¹çµæœ: <strong>{{ diceResult }}</strong></div>
          </div>
          <div v-else>
            <div v-for="(choice, i) in playingNode.choices" v-if="choice.text && choice.next != null">
              <button @click="goTo(choice.next)" class="btn go-to-btn">{{ choice.text }}</button>
            </div>
          </div>
        </div>
        <button @click="resetPlay" class="reset-btn" alt="æœ€åˆã«æˆ»ã‚‹">â‰¡</button>
      </div>
    </template>

    <template v-else>
      <h1>ã‚²ãƒ¼ãƒ ãƒ–ãƒƒã‚¯ä½œæˆãƒ„ãƒ¼ãƒ«</h1>

      <div class="node-list">
        <div v-for="node in nodes" :key="node.id"
             :class="['node-button', { active: currentNodeId === node.id }]"
             @click="currentNodeId = node.id">
          ãƒãƒ¼ãƒ‰ {{ node.id }}
          <span v-if="node.id !== 0" class="danger" @click.stop="deleteNode(node.id)">Ã—</span>
        </div>
        <div class="node-button" @click="addNode">+</div>
        <!-- findUnreachableNodes -->
        <div v-if="findUnreachableNodes(nodes).length > 0" class="danger">
          åˆ°é”ä¸å¯èƒ½ãªãƒãƒ¼ãƒ‰: {{ findUnreachableNodes(nodes).join(', ') }}
          <span class="danger" @click="findUnreachableNodes(nodes).forEach(id => deleteNode(id))">å‰Šé™¤</span>
        </div>
      </div>

      <div class="editor" v-if="currentNode">
        <h2>ãƒãƒ¼ãƒ‰ç·¨é›† (ID: {{ currentNode.id }})</h2>
        <div>
          <label>ãƒ†ã‚­ã‚¹ãƒˆ:</label>
          <textarea v-model="currentNode.text"></textarea>
        </div>
        <div>
          <label>ç”»åƒURL (pngæ¨å¥¨):</label>
          <input v-model="currentNode.imageUrl" placeholder="ä¾‹: https://example.com/sample.png" />
          <div v-if="currentNode.imageUrl" style="margin-top:5px;">
            <img :src="currentNode.imageUrl" alt="ãƒãƒ¼ãƒ‰ç”»åƒ" style="max-width:200px; max-height:150px; border:1px solid #ccc; border-radius:4px;" />
          </div>
        </div>
        <div>
          <label>é¸æŠè‚¢1:</label>
          <input v-model="currentNode.choices[0].text" placeholder="ãƒ†ã‚­ã‚¹ãƒˆ" />
          <input v-model.number="currentNode.choices[0].next" type="number" placeholder="é·ç§»å…ˆID" />
          <div style="display:flex;gap:4px;align-items:center;">
            <label style="margin:0;">minDice:</label>
            <input v-model.number="currentNode.choices[0].minDice" type="number" min="2" max="12" style="width:60px;" placeholder="2" />
            <label style="margin:0;">maxDice:</label>
            <input v-model.number="currentNode.choices[0].maxDice" type="number" min="2" max="12" style="width:60px;" placeholder="12" />
            <span style="font-size:12px;color:#888;">(2d6åˆ†å²ç”¨)</span>
          </div>
        </div>
        <div>
          <label>é¸æŠè‚¢2:</label>
          <input v-model="currentNode.choices[1].text" placeholder="ãƒ†ã‚­ã‚¹ãƒˆ" />
          <input v-model.number="currentNode.choices[1].next" type="number" placeholder="é·ç§»å…ˆID" />
          <div style="display:flex;gap:4px;align-items:center;">
            <label style="margin:0;">minDice:</label>
            <input v-model.number="currentNode.choices[1].minDice" type="number" min="2" max="12" style="width:60px;" placeholder="2" />
            <label style="margin:0;">maxDice:</label>
            <input v-model.number="currentNode.choices[1].maxDice" type="number" min="2" max="12" style="width:60px;" placeholder="12" />
            <span style="font-size:12px;color:#888;">(2d6åˆ†å²ç”¨)</span>
          </div>
        </div>
      </div>

      <div class="graph-view">
        <h2>ãƒãƒ¼ãƒ‰ãƒãƒƒãƒ—</h2>
        <div v-for="node in nodes" :key="'map-'+node.id" style="margin-bottom:12px;">
          <strong>ãƒãƒ¼ãƒ‰ {{ node.id }}</strong>: {{ node.text || 'ï¼ˆãƒ†ã‚­ã‚¹ãƒˆæœªè¨­å®šï¼‰' }}
          <div v-if="node.imageUrl" style="margin: 4px 0;">
            <img :src="node.imageUrl" alt="ãƒãƒ¼ãƒ‰ç”»åƒ" style="max-width: 100px; max-height: 60px; border:1px solid #ccc; border-radius:3px;" />
          </div>
          <ul>
            <li v-for="(choice, i) in node.choices">
              {{ choice.text || 'ï¼ˆé¸æŠè‚¢ãªã—ï¼‰' }} â†’
              <span :style="{ color: isValidLink(choice.next) ? 'black' : 'red' }">
                {{ choice.next !== null ? 'ãƒãƒ¼ãƒ‰ ' + choice.next : 'ï¼ˆæœªè¨­å®šï¼‰' }}
              </span>
            </li>
          </ul>
        </div>
      </div>

      <div>
        <!-- <button @click="playMode = true" class="btn">ãƒ—ãƒ¬ã‚¤</button> -->
         <!-- play=trueã®getparamã‚’ã¤ã‘ã¦ãƒªãƒ³ã‚¯ã‚¸ãƒ£ãƒ³ãƒ— -->
        <a :href="'?play=true'" class="btn">ãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰ã¸</a>

        <button @click="exportJSON" class="btn">JSONå‡ºåŠ›</button>
        <button @click="loadSample(1)" class="btn">ã‚µãƒ³ãƒ—ãƒ«1</button>

        <input type="file" accept=".json" @change="importJSON" class="btn" style="padding:5px 10px;" />
      </div>
    </template>
  </div>

  <script>
    new Vue({
      el: "#app",
      data: {
        nodes: [],
        currentNodeId: 0,
        playMode: false,
        playingNodeId: 0,
        nextId: 1,
        diceResult: null
      },
      computed: {
        currentNode() {
          return this.nodes.find(n => n.id === this.currentNodeId);
        },
        playingNode() {
          return this.nodes.find(n => n.id === this.playingNodeId);
        }
      },
      methods: {
        addNode() {
          this.nodes.push({
            // æœ€å¤§ã®idã«1ã‚’è¶³ã—ãŸå€¤ã‚’æ–°ã—ã„ãƒãƒ¼ãƒ‰ã®idã¨ã™ã‚‹
            id: this.nodes.reduce((max, n) => (n.id > max ? n.id : max), 0) + 1,
            text: '',
            imageUrl: '',
            choices: [
              { text: '', next: null },
              { text: '', next: null }
            ]
          });
        },
        deleteNode(id) {
          if (id === 0) return;
          this.nodes = this.nodes.filter(n => n.id !== id);
          if (this.currentNodeId === id) {
            this.currentNodeId = 0;
          }
        },
        goTo(id) {
          // next: "END" ã®å ´åˆã¯ id:1 ã«æˆ»ã™
          if (id === "END") {
            this.playingNodeId = 1;
            this.diceResult = null;
          } else {
            this.playingNodeId = id;
            this.diceResult = null; // ãƒ€ã‚¤ã‚¹çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
          }
        },
resetPlay() {
  if (new URLSearchParams(window.location.search).get('play') === 'true') {
    // ?play=true ã®æ™‚ã¯ãƒ—ãƒ¬ã‚¤ç”»é¢ã®æœ€åˆã®ãƒãƒ¼ãƒ‰ã«æˆ»ã‚‹ã ã‘
    this.playingNodeId = 1;
  } else {
    // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ç·¨é›†ç”»é¢ã«æˆ»ã™
    this.playMode = false;
    this.playingNodeId = 1;
  }
},

        exportJSON() {
          const json = JSON.stringify(this.nodes, null, 2);
          const blob = new Blob([json], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "gamebook.json";
          a.click();
          URL.revokeObjectURL(url);
        },
        importJSON(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const json = JSON.parse(e.target.result);

              // ç°¡æ˜“æ§‹é€ ãƒã‚§ãƒƒã‚¯
              if (!Array.isArray(json)) throw new Error("JSONã¯é…åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
              for (const node of json) {
                if (typeof node.id !== "number") throw new Error("ãƒãƒ¼ãƒ‰ã®idãŒä¸æ­£ã§ã™ã€‚");
                if (typeof node.text !== "string") throw new Error("ãƒãƒ¼ãƒ‰ã®textãŒä¸æ­£ã§ã™ã€‚");
                if (node.imageUrl !== undefined && typeof node.imageUrl !== "string")
                  throw new Error("imageUrlã¯æ–‡å­—åˆ—ã‹æœªå®šç¾©ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
                if (!Array.isArray(node.choices)) throw new Error("choicesã¯é…åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
                for (const choice of node.choices) {
                  if (typeof choice.text !== "string")
                    throw new Error("choice.textãŒä¸æ­£ã§ã™ã€‚");
                  if (choice.next !== null && typeof choice.next !== "number")
                    throw new Error("choice.nextã¯nullã‹æ•°å€¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
                }
              }

              this.nodes = json;
              this.currentNodeId = this.nodes.length > 0 ? this.nodes[0].id : 0;
              this.playingNodeId = 0;
              this.nextId = this.nodes.reduce((max, n) => (n.id > max ? n.id : max), 0) + 1;

              alert("JSONèª­ã¿è¾¼ã¿æˆåŠŸã—ã¾ã—ãŸã€‚");
            } catch (err) {
              alert("JSONèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: " + err.message);
            }
          };
          reader.readAsText(file);

          event.target.value = "";
        },
        isValidLink(id) {
          if (id === null || id === undefined) return true;
          return this.nodes.some((n) => n.id === id);
        },
        loadSample(type = 1) {
          const imgSampleUrl =
            "https://raw.githubusercontent.com/taroyanaka/asset/refs/heads/main/image/sample_neuro.png";
          const samples = {
1: [
    { id: 1, text: "æ¸‹è°·ã®äº¤å·®ç‚¹ã§ä¸æ€è­°ãªãƒã‚¤ã‚ºã‚’èã„ãŸå›ã¯ã€ãã®åŸå› ã‚’æ¢ã‚‹ã‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æ¢ã‚‹", next: 5 }, { text: "ã‚„ã‚ã‚‹", next: 8 }] },
    { id: 2, text: "è·¯åœ°è£ã«ç¾ã‚ŒãŸè¬ã®ç”·ã«å£°ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã€è©±ã‚’èãã‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è©±ã‚’èã", next: 11 }, { text: "ç„¡è¦–ã™ã‚‹", next: 13 }] },
    { id: 3, text: "ä¿¡ã˜ã‚‹ã‹ã©ã†ã‹ã®æ°—åˆ†ã‚’ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«ã§æ±ºã‚ã‚‹ã€‚", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 1 }, { text: "ğŸ²:10-12", next: 5 }] },
    { id: 4, text: "ã‚³ãƒ³ãƒ“ãƒ‹ã§è¦‹çŸ¥ã‚‰ã¬USBã‚’æ‹¾ã£ãŸå›ã¯ã€å®¶ã§ä¸­èº«ã‚’ç¢ºèªã™ã‚‹ã‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "ç¢ºèªã™ã‚‹", next: 22 }, { text: "ã‚„ã‚ã‚‹", next: 25 }] },
    { id: 5, text: "ãƒã‚¤ã‚ºã®ç™ºä¿¡æºã¯åœ°ä¸‹é‰„ã®ãƒ›ãƒ¼ãƒ ã‹ï¼Ÿæ¢ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æ¢ã‚‹", next: 2 }, { text: "ã‚„ã‚ã‚‹", next: 4 }] },
    { id: 6, text: "ä¿¡ã˜ã‚‰ã‚Œãªã„ãŒ......", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 30 }, { text: "ğŸ²:7-9", next: 32 }, { text: "ğŸ²:10-12", next: 34 }] },
    { id: 7, text: "é«˜æ ¡æ™‚ä»£ã®å‹äººãƒ»é¥ãŒã€Œæ˜¨æ—¥è¦‹ãŸå¤¢ãŒç¾å®Ÿã«ãªã£ã¦ã‚‹ã€ã¨è¨€ã†ã€‚ä¿¡ã˜ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "ä¿¡ã˜ã‚‹", next: 3 }, { text: "ä¿¡ã˜ãªã„", next: 6 }] },
    { id: 8, text: "ãƒã‚¤ã‚ºã‚’éŒ²éŸ³ã—ãŸã‚¹ãƒãƒ›ãŒç†±ã‚’å¸¯ã³å§‹ã‚ã‚‹ã€‚é›»æºã‚’åˆ‡ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "åˆ‡ã‚‹", next: 12 }, { text: "åˆ‡ã‚‰ãªã„", next: 14 }] },
    { id: 9, text: "å—ã‘å–ã£ãŸçµæœ", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 35 }, { text: "ğŸ²:7-9", next: 37 }, { text: "ğŸ²:10-12", next: 39 }] },
    { id: 10, text: "å›ã®éƒ¨å±‹ã®é¡ã«ã€ŒHELPã€ã¨æ›¸ã‹ã‚ŒãŸæ‰‹å½¢ã€‚è­¦å¯Ÿã«é€£çµ¡ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "é€£çµ¡ã™ã‚‹", next: 20 }, { text: "é€£çµ¡ã—ãªã„", next: 23 }] },
    { id: 11, text: "ç”·ã¯ã€Œå›ã«ã¯â€œè¦–ãˆã‚‹åŠ›â€ãŒã‚ã‚‹ã€ã¨è¨€ã„ã€ä¸æ€è­°ãªãƒ¬ãƒ³ã‚ºã‚’æ¸¡ã™ã€‚å—ã‘å–ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "å—ã‘å–ã‚‹", next: 9 }, { text: "æ–­ã‚‹", next: 10 }] },
    { id: 12, text: "ã‚¹ãƒãƒ›ãŒçˆ†ç™ºã€æ„è­˜ã‚’å¤±ã£ãŸå›ã¯è¦‹çŸ¥ã‚‰ã¬ç—…å®¤ã§ç›®è¦šã‚ã‚‹ã€‚è„±å‡ºï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è„±å‡ºã™ã‚‹", next: 26 }, { text: "è„±å‡ºã—ãªã„", next: 28 }] },
    { id: 13, text: "ç”·ã®è¨€è‘‰ã‚’ç„¡è¦–ã—ã¦é€šã‚Šã‚’æ­©ãã¨ã€è»Šã«è½¢ã‹ã‚Œãã†ã«ãªã‚‹ã€‚é¿ã‘ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "é¿ã‘ã‚‹", next: 7 }, { text: "é¿ã‘ãªã„", next: 15 }] },
    { id: 14, text: "ç†±æš´èµ°ã—ãŸã‚¹ãƒãƒ›ãŒå¥‡å¦™ãªéŸ³ã‚’ç™ºã—ç¶šã‘ã‚‹ã€‚éŒ²éŸ³ã‚’åœæ­¢ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "åœæ­¢ã™ã‚‹", next: 21 }, { text: "åœæ­¢ã—ãªã„", next: 24 }] },
    { id: 15, text: "åœ°é¢ãŒæºã‚Œã€å›ã¯åœ°ä¸­æ·±ãã«å¸ã„è¾¼ã¾ã‚Œã‚‹æ„Ÿè¦šã«è¥²ã‚ã‚Œã‚‹ã€‚æŠµæŠ—ã™ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æŠµæŠ—ã™ã‚‹", next: 27 }, { text: "æŠµæŠ—ã—ãªã„", next: 6 }] },
    { id: 16, text: "åœ°ä¸‹é‰„ã®å¥¥ã«è¿‘ã¥ã„ãŸçµæœ", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 40 }, { text: "ğŸ²:7-9", next: 42 }, { text: "ğŸ²:10-12", next: 44 }] },
    { id: 17, text: "åœ°ä¸‹é‰„ã®å¥¥ã€èª°ã‚‚ã„ãªã„ãƒ›ãƒ¼ãƒ ã«è½ã¡ã‚‹å½±ã€‚è¿‘ã¥ãï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è¿‘ã¥ã", next: 16 }, { text: "è¿‘ã¥ã‹ãªã„", next: 18 }] },
    { id: 18, text: "å½±ãŒçªç„¶äººå‹ã«ãªã‚Šã€å›ã«è©±ã—ã‹ã‘ã¦ãã‚‹ã€‚ã€Œæˆ»ã‚Œã€ã¨ã€‚å¾“ã†ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "å¾“ã†", next: 31 }, { text: "å¾“ã‚ãªã„", next: 33 }] },
    { id: 19, text: "è¿½ã„ã‹ã‘ãŸçµæœ", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 36 }, { text: "ğŸ²:7-9", next: 38 }, { text: "ğŸ²:10-12", next: 41 }] },
    { id: 20, text: "è­¦å¯Ÿã¯æ‰‹å½¢ã‚’ã€Œæ‚ªæˆ¯ã€ã¨ç‰‡ã¥ã‘ã‚‹ã€‚è¨¼æ‹ ã‚’æ¢ã™ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æ¢ã™", next: 29 }, { text: "æ¢ã•ãªã„", next: 10 }] },
    { id: 21, text: "éŸ³ã‚’åœæ­¢ã—ãŸç›´å¾Œã€éƒ¨å±‹ãŒä¸€ç¬çœŸã£æš—ã«ãªã‚‹ã€‚ç¢ºèªã™ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "ç¢ºèªã™ã‚‹", next: 43 }, { text: "ç¢ºèªã—ãªã„", next: 45 }] },
    { id: 22, text: "USBã«ã¯ã€ŒShibuya_Ghost_Projectã€ã¨è¨˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã€‚é–‹ãï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "é–‹ã", next: 46 }, { text: "é–‹ã‹ãªã„", next: 48 }] },
    { id: 23, text: "è‡ªåˆ†ã§èª¿æŸ»ã‚’å§‹ã‚ã‚‹ã¨ã€éå»ã®äº‹ä»¶ãŒæµ®ã‹ã³ä¸ŠãŒã‚‹ã€‚è¿½ã†ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è¿½ã†", next: 19 }, { text: "è¿½ã‚ãªã„", next: 17 }] },
    { id: 24, text: "ã‚¹ãƒãƒ›ãŒå¥‡æ€ªãªæ˜ åƒã‚’æŠ•å½±ã—å§‹ã‚ã‚‹ã€‚è¨˜éŒ²ã™ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è¨˜éŒ²ã™ã‚‹", next: 49 }, { text: "è¨˜éŒ²ã—ãªã„", next: 50 }] },
    { id: 25, text: "USBã‚’æ¨ã¦ãŸç›´å¾Œã€è¡—ä¸­ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ãŒå›ã®åå‰ã‚’æ˜ ã™ã€‚é€ƒã’ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "é€ƒã’ã‚‹", next: 20 }, { text: "é€ƒã’ãªã„", next: 21 }] },
    { id: 26, text: "ç—…å®¤ã«ã¯ç›£è¦–ã‚«ãƒ¡ãƒ©ãŒã‚ã‚‹ã€‚å£Šã™ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "å£Šã™", next: 38 }, { text: "å£Šã•ãªã„", next: 40 }] },
    { id: 27, text: "é—‡ã®ä¸­ã§å£°ãŒã™ã‚‹ã€‚ã€ŒçŸ¥ã‚ŠãŸã„ã‹ï¼Ÿã€ç­”ãˆã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "ç­”ãˆã‚‹", next: 44 }, { text: "ç­”ãˆãªã„", next: 46 }] },
    { id: 28, text: "ç‚¹æ»´ã«è¬ã®æ¶²ä½“ãŒæ··ã–ã£ã¦ã„ã‚‹ã€‚æŠœãï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æŠœã", next: 29 }, { text: "æŠœã‹ãªã„", next: 31 }] },
    { id: 29, text: "æ˜”ã®æ–°èè¨˜äº‹ã«ã€å›ã¨åŒã˜åå‰ã®å¤±è¸ªè€…ãŒå‡ºã¦ãã‚‹ã€‚èª¿ã¹ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "èª¿ã¹ã‚‹", next: 35 }, { text: "èª¿ã¹ãªã„", next: 37 }] },
    { id: 30, text: "ä½•ã‹ãŒèµ·ãã‚‹", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 6 }, { text: "ğŸ²:7-9", next: 8 }, { text: "ğŸ²:10-12", next: 12 }] },
    { id: 31, text: "åœ°ä¸‹é€šè·¯ã«é™ã‚Šã‚‹éšæ®µãŒã‚ã‚‹ã€‚é™ã‚Šã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "é™ã‚Šã‚‹", next: 16 }, { text: "é™ã‚Šãªã„", next: 18 }] },
    { id: 32, text: "ãã®å…ˆã«å›ã¨åŒã˜é¡”ã®äººç‰©ãŒç«‹ã£ã¦ã„ã‚‹ã€‚è©±ã™ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è©±ã™", next: 34 }, { text: "è©±ã•ãªã„", next: 36 }] },
    { id: 33, text: "å£°ã®ä¸»ã¯å›ã®â€œåˆ¥ã®äººç”Ÿâ€ã®è¨˜éŒ²ã‚’è¦‹ã›ã‚‹ã€‚å—ã‘å…¥ã‚Œã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "å—ã‘å…¥ã‚Œã‚‹", next: 39 }, { text: "æ‹’å¦ã™ã‚‹", next: 41 }] },
    { id: 34, text: "é¡ã®ä¸­ã®è‡ªåˆ†ãŒå‹•ã‹ãªã„ã€‚è§¦ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "è§¦ã‚‹", next: 43 }, { text: "è§¦ã‚‰ãªã„", next: 45 }] },
    { id: 35, text: "è¨˜éŒ²ã¯å›ãŒ10å¹´å‰ã«æ­»äº¡ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™ã€‚ä¿¡ã˜ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "ä¿¡ã˜ã‚‹", next: 47 }, { text: "ä¿¡ã˜ãªã„", next: 48 }] },
    { id: 36, text: "ãã®äººç‰©ã¯å›ã«è­¦å‘Šã™ã‚‹ã€‚ã€Œæˆ»ã‚Œã‚‹ã®ã¯1åº¦ã ã‘ã€å¾“ã†ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "å¾“ã†", next: 44 }, { text: "å¾“ã‚ãªã„", next: 46 }] },
    { id: 37, text: "è¨˜äº‹ã®å ´æ‰€ã«å‘ã‹ã†ã¨ã€ç¥ ãŒã‚ã‚‹ã€‚æ‰‰ã‚’é–‹ã‘ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "é–‹ã‘ã‚‹", next: 49 }, { text: "é–‹ã‘ãªã„", next: 50 }] },
    { id: 38, text: "ã‚«ãƒ¡ãƒ©ã‚’å£Šã™ã¨ã‚¢ãƒ©ãƒ¼ãƒ ãŒé³´ã‚ŠéŸ¿ãã€‚éš ã‚Œã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "éš ã‚Œã‚‹", next: 42 }, { text: "éš ã‚Œãªã„", next: 43 }] },
    { id: 39, text: "â€œåˆ¥ã®å›â€ãŒæ‰‹ã‚’å·®ã—ä¼¸ã¹ã‚‹ã€‚ã€Œã“ã®ä¸–ç•Œã‚’é¸ã¶ï¼Ÿã€æ¡ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æ¡ã‚‹", next: 50 }, { text: "æ¡ã‚‰ãªã„", next: 48 }] },
    { id: 40, text: "å£Šã—ãŸçµæœ", imageUrl: imgSampleUrl,
      choices: [{ text: "ğŸ²:2-6", next: 45 }, { text: "ğŸ²:7-9", next: 47 }, { text: "ğŸ²:10-12", next: 49 }] },
    { id: 41, text: "è‡ªåˆ†ã®è¨˜æ†¶ãŒä¸€éƒ¨æ”¹ã–ã‚“ã•ã‚Œã¦ã„ãŸã“ã¨ã‚’æ€ã„å‡ºã™ã€‚æŠ—ã†ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æŠ—ã†", next: 44 }, { text: "æŠ—ã‚ãªã„", next: 46 }] },
    { id: 42, text: "ç—…é™¢ã®è£å£ã‹ã‚‰è„±å‡ºã€‚å¤–ã«ã¯èª°ã‚‚ã„ãªã„æ±äº¬ã€‚æ¢ç´¢ã™ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æ¢ç´¢ã™ã‚‹", next: 47 }, { text: "æ¢ç´¢ã—ãªã„", next: 50 }] },
    { id: 43, text: "éƒ¨å±‹ã«â€œå›â€ãŒ2äººã„ã‚‹ã€‚ã©ã¡ã‚‰ãŒæœ¬ç‰©ã‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [
        { text: "1äººç›®", next: 18 },
        { text: "2äººç›®", next: 39 }
      ]
    },
    { id: 44, text: "å›ã¯çœŸå®Ÿã‚’é¸ã‚“ã ã€‚ã™ã¹ã¦ã‚’çŸ¥ã£ãŸä¸Šã§æˆ»ã‚‹ã‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æˆ»ã‚‹", next: 50 }, { text: "æˆ»ã‚‰ãªã„", next: 1 }] },
    { id: 45, text: "å›ã¯é¸ã°ãªã‹ã£ãŸã€‚ä¸–ç•Œã¯é™ã‹ã«çµ‚ã‚ã‚Šã‚’è¿ãˆã‚‹ã€‚", imageUrl: imgSampleUrl,
      choices: [{ text: "å†é–‹", next: 1 }, { text: "çµ‚äº†", next: 50 }] },
    { id: 46, text: "å›ã®è¨˜æ†¶ã¯æ”¹ã–ã‚“ã•ã‚Œã¦ã„ãŸã€‚å…ƒã®è‡ªåˆ†ã«æˆ»ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "æˆ»ã‚‹", next: 42 }, { text: "æˆ»ã‚‰ãªã„", next: 38 }] },
    { id: 47, text: "æ±äº¬ã¯å®Ÿé¨“éƒ½å¸‚ã ã£ãŸã€‚ç›®è¦šã‚ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "ç›®è¦šã‚ã‚‹", next: 1 }, { text: "ç›®è¦šã‚ãªã„", next: "END" }] },
    { id: 48, text: "å…¨ã¦ã‚’æ¨ã¦ã¦å¹³å‡¡ãªæ—¥å¸¸ã¸æˆ»ã‚‹ã€‚", imageUrl: imgSampleUrl,
      choices: [{ text: "æˆ»ã‚‹", next: 1 }, { text: "çµ‚ã‚ã‚‹", next: "END" }] },
    { id: 49, text: "å…¨ã¦ã®è¬ãŒç¹‹ãŒã£ãŸã€‚ä¸–ç•Œã¯å›ã‚’ä¸­å¿ƒã«å‹•ã„ã¦ã„ãŸã€‚", imageUrl: imgSampleUrl,
      choices: [{ text: "çµ‚ã‚ã‚‹", next: "END" }, { text: "çµ‚ã‚ã‚‹", next: "END" }] },
    { id: 50, text: "æœ¬å½“ã®å›ã¯ä»Šã©ã“ã«ã„ã‚‹ï¼Ÿã“ã‚Œã§çµ‚ã‚ã‚Šã«ã™ã‚‹ï¼Ÿ", imageUrl: imgSampleUrl,
      choices: [{ text: "çµ‚ã‚ã‚‹", next: "END" }, { text: "ã‚‚ã†ä¸€åº¦", next: 1 }] }
  ],

          };
          this.nodes = JSON.parse(JSON.stringify(samples[type]));
          this.currentNodeId = 0;
          this.playingNodeId = 0;
          this.nextId = this.nodes.length;
        },
        hasDiceBranch(node) {
          // ã©ã‚Œã‹ã®é¸æŠè‚¢ã«minDice/maxDiceãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°true
          return node.choices.some(c => c.minDice !== undefined && c.maxDice !== undefined && c.minDice !== null && c.maxDice !== null);
        },
        rollDiceForNode() {
          // 2d6ã‚’æŒ¯ã‚‹
          const dice1 = Math.floor(Math.random() * 6) + 1;
          const dice2 = Math.floor(Math.random() * 6) + 1;
          const total = dice1 + dice2;
          this.diceResult = total;
          // åˆè‡´ã™ã‚‹é¸æŠè‚¢ã‚’æ¢ã™
          const node = this.playingNode;
          const found = node.choices.find(c => c.minDice !== undefined && c.maxDice !== undefined && c.minDice !== null && c.maxDice !== null && total >= c.minDice && total <= c.maxDice && c.next != null);
          if (found) {
            setTimeout(() => {
              this.goTo(found.next);
              this.diceResult = null;
            }, 800);
          }
        },
        findUnreachableNodes(sample) {
          // ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰IDã‚’å–å¾—
          const allNodeIds = new Set(sample.map(n => n.id));
          // ã™ã¹ã¦ã®é·ç§»å…ˆIDã‚’å–å¾—
          const reachableIds = new Set();
          sample.forEach(node => {
            node.choices.forEach(choice => {
              if (choice.next !== null) {
                reachableIds.add(choice.next);
              }
            });
          });
          // åˆ°é”ä¸å¯èƒ½ãªãƒãƒ¼ãƒ‰ã‚’ç‰¹å®š
          return Array.from(allNodeIds).filter(id => !reachableIds.has(id) && id !== 0);
        },

      },
      mounted() {
        // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯
        const params = new URLSearchParams(window.location.search);
        if (params.get('play') === 'true') {
          this.loadSample(1);
          this.playMode = true;
          this.playingNodeId = 1;
        }

      }
    });
  </script>
</body>
</html>
